<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.alige.data.md.dao.FutureOptionPriceDao">
    <select id="checkTableExist" resultType="string">
        select table_name FROM information_schema.tables WHERE table_schema=#{dataBaseName} and table_name=#{tableName}
    </select>
    <update id="createOptionPriceTable">
        create table ${tableName} (
        id  SERIAL PRIMARY KEY,
        t_date integer,
        t_time integer,
        update_milli_sec integer,
        contract_id varchar(31),
        exchange_inst_id varchar(31),
        contract_name varchar(12),
        last_px numeric(14, 3),
        high_px numeric(14, 3),
        low_px numeric(14, 3),
        cq numeric(15),
        cm numeric(18, 3),
        qc varchar(9),
        tq numeric(11),
        tm numeric(18, 2),
        last_qty numeric(11),
        init_open_ints integer,
        open_ints numeric(11),
        ints_chg integer,
        upper_limit numeric(12, 3),
        lower_limit numeric(12, 3),
        pre_settle numeric(12, 3),
        pre_close numeric(12, 3),
        s1 numeric(12, 3),
        b1 numeric(12, 3),
        sv1 numeric(11),
        bv1 numeric(11),
        open_px numeric(12, 3),
        close_px numeric(12, 3),
        settle_px numeric(12, 3),
        life_low numeric(12, 3),
        life_high numeric(12, 3),
        avg_px numeric(14, 4),
        bid_imply_qty numeric(11),
        ask_imply_qty numeric(11),
        s5 numeric(12, 3),
        s4 numeric(12, 3),
        s3 numeric(12, 3),
        s2 numeric(12, 3),
        b2 numeric(12, 3),
        b3 numeric(12, 3),
        b4 numeric(12, 3),
        b5 numeric(12, 3),
        sv5 numeric(11),
        sv4 numeric(11),
        sv3 numeric(11),
        sv2 numeric(11),
        bv2 numeric(11),
        bv3 numeric(11),
        bv4 numeric(11),
        bv5 numeric(11),
        pre_delta numeric(12, 3),
        curr_delta numeric(12, 3),
        local_tm varchar(25),
        market varchar(9),
        chg numeric(12, 3),
        chg_pct numeric(7, 3),
        settle_group_id varchar(9),
        settle_id integer,
        clearing_day integer,
        m_flag char(1),
        source varchar(9),
        commodity_no varchar(5),
        offset1 integer,
        t_flag char(1)
        );
        comment on table ${tableName} is '期货TickData表';
        comment on column ${tableName}.id is '数据ID';
        comment on column ${tableName}.t_date is '数据日期';
    </update>

    <insert id="insertOptionPriceBatch" parameterType="org.alige.data.md.model.FutureOptionPrice">
        INSERT INTO ${tableName} (t_date,t_time,update_milli_sec,contract_id,exchange_inst_id,contract_name,last_px,high_px,
        low_px,cq,cm,qc,tq,tm,last_qty,init_open_ints,open_ints,ints_chg,upper_limit,lower_limit,pre_settle,pre_close,
        s1,b1,sv1,bv1,open_px,close_px,settle_px,life_low,life_high,avg_px,bid_imply_qty,ask_imply_qty,s5,s4,s3,s2,b2,b3,
        b4,b5,sv5,sv4,sv3,sv2,bv2,bv3,bv4,bv5,pre_delta,curr_delta,local_tm,market,chg,chg_pct,settle_group_id,settle_id,
        clearing_day,m_flag,source,commodity_no,offset1,t_flag)
        VALUES
        <foreach collection="priceList" item="price" separator=",">
            (#{price.tdate},#{price.ttime},#{price.updateMilliSec},#{price.contractId},#{price.exchangeInstId},#{price.contractName},
            #{price.lastPx},#{price.highPx},#{price.lowPx},long,#{price.cq},#{price.cm},#{price.qc},#{price.tq},#{price.tm},
            #{price.lastQty},#{price.initOpenInts},#{price.openInts},#{price.intsChg},#{price.upperLimit},#{price.lowerLimit},
            #{price.preSettle},#{price.preClose},#{price.s1},#{price.b1},#{price.sv1},#{price.bv1},#{price.openPx},#{price.closePx},
            #{price.settlePx},#{price.lifeLow},#{price.lifeHigh},#{price.avgPx},#{price.bidImplyQty},#{price.askImplyQty},#{price.s5},
            #{price.s4},#{price.s3},#{price.s2},#{price.b2},#{price.b3},#{price.b4},#{price.b5},#{price.sv5},#{price.sv4},#{price.sv3},
            #{price.sv2},#{price.bv2},#{price.bv3},#{price.bv4},#{price.bv5},#{price.preDelta},#{price.currDelta},#{price.localTm},
            #{price.market},#{price.chg},#{price.chgPct},#{price.settleGroupId},#{price.settleId},#{price.clearingDay},#{price.mflag},
            #{price.source},#{price.commodityNo},#{price.offset},#{price.tflag})
        </foreach>
    </insert>

    <update id="createOptionPriceMinTable">
        create table ${tableName} (
        id  SERIAL PRIMARY KEY,
        clearing_day integer,
        t_date integer,
        contract_id varchar(31),
        offset integer,
        market char(5),
        bar_time varchar(5),
        close_px numeric(12, 3),
        open_px numeric(12, 3),
        high_px numeric(12, 3),
        low_px numeric(12, 3),
        volume numeric(11),
        value numeric(18, 3),
        vwap numeric(12, 3),
        open_ints numeric(11)
        )
    </update>

    <insert id="insertOptionPriceMinBatch" parameterType="org.alige.data.md.model.FutureOptionPriceMin">
        INSERT INTO ${tableName} (clearing_day, t_date, contract_id, offset, market, bar_time, close_px, open_px,
        high_px, low_px, volume, value, vwap, open_ints)
        VALUES
        <foreach collection="priceList" item="price" separator=",">
            (#{price.clearingDay}, #{price.tdate}, #{price.contractId}, #{price.offset}, #{price.market}, #{price.barTime}, #{price.closePx}, #{price.openPx},
            #{price.highPx}, #{price.lowPx}, #{price.volume}, #{price.value}, #{price.vwap}, #{price.openInts})
        </foreach>
    </insert>
</mapper>